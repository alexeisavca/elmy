{"version":3,"sources":["index.es6"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport {Iterable} from \"immutable\";\r\nimport module2component from \"./lib/toComponent\";\r\nimport buildModel from \"./lib/buildModel/index.es6\";\r\nimport isMappable from \"./lib/isMappable\";\r\n\r\nexport default function(domNode, module){\r\n  let Root = module2component(module);\r\n  let render = model => ReactDOM.render(React.createElement(Root, {model, send: receive}), domNode);\r\n\r\n  let model = buildModel(module);\r\n\r\n  function receive(...params){\r\n    try{\r\n      model = update(module, model, params);\r\n      render(model);\r\n    } catch(e){\r\n      if(\"NoActionHandler\" == e.message) {\r\n        console.error(\"Could not find handler for action\", params);\r\n      } else if(\"InvalidState\" == e.message){\r\n        console.error(\"Invalid state returned by an action handler while trying to perform\", params);\r\n      } else throw e;\r\n    }\r\n  }\r\n\r\n  const NO_MATCH_FOUND = Symbol();\r\n\r\n  function match(model, [head, ...tail], target, nextState){\r\n    if(\"function\" == typeof target){\r\n      let result = target(model, nextState, head, ...tail);\r\n      if(!Iterable.isIterable(result)) throw new Error(\"InvalidState\");\r\n      return result;\r\n    }\r\n    switch(typeof target[head]){\r\n      case \"function\" :\r\n        let result = target[head](model, nextState, ...tail);\r\n        if(!Iterable.isIterable(result)) throw new Error(\"InvalidState\");\r\n        return result;\r\n      case \"object\": return match(model, tail, target[head], nextState);\r\n    }\r\n    if(\"undefined\" != typeof target._) return match(model, ['_', ...tail], target, nextState);\r\n    return NO_MATCH_FOUND;\r\n  }\r\n\r\n  function update(module, model, [head, ...tail], dontMatch = false){\r\n    if(!dontMatch) {\r\n      let nextState = update.bind(null, module, model, [head, ...tail], true);\r\n      let matchResult = match(model, [head, ...tail], module.update || {}, nextState);\r\n      if(matchResult != NO_MATCH_FOUND) return matchResult;\r\n    }\r\n\r\n    if(module.adopt && module.adopt[head]) {\r\n      let path = isMappable(model.get(head)) ? [head, tail.shift()] : [head];\r\n      return model.setIn(path, update(module.adopt[head], model.getIn(path), tail))\r\n    }\r\n\r\n    if(\"change\" == head){\r\n      let [key, val] = tail;\r\n      return model.set(key, val);\r\n    }\r\n\r\n    throw new Error(\"NoActionHandler\");\r\n  }\r\n\r\n  render(model);\r\n}"]}